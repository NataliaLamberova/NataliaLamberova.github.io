p_load(patchwork)
pdf("figs/fe/fam_army1.pdf")
za/
zb
dev.off()
pdf("figs/fe/fam_army2.pdf")
zc/
zd
dev.off()
a11<-lm(data = d4[d4$V248<11,],V248~T4_4+as.factor(oblast)+as.factor(settlement_type)+as.factor(settlement)+as.factor(sex)+sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement))
a12<-lm(data = d4[d4$V249<11,],V249~T4_4+as.factor(oblast)+as.factor(settlement_type)+as.factor(settlement)+as.factor(sex)+sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement))
a13<-lm(data = d4[d4$V250<11,],V250~T4_4+as.factor(oblast)+as.factor(settlement_type)+as.factor(settlement)+as.factor(sex)+sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement))
a14<-lm(data = d4[d4$V250<11,],att~T4_4+as.factor(oblast)+as.factor(settlement_type)+as.factor(settlement)+as.factor(sex)+sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement))
b11<-lm(data = d4[d4$V264==1,],V259~T4_4+as.factor(oblast)+as.factor(settlement_type)+as.factor(settlement)+as.factor(sex)+sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement))
b12<-lm(data = d4[d4$V264==1,],V260~T4_4+as.factor(oblast)+as.factor(settlement_type)+as.factor(settlement)+as.factor(sex)+sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement))
b13<-lm(data = d4[d4$V264==1,],V261~T4_4+as.factor(oblast)+as.factor(settlement_type)+as.factor(settlement)+as.factor(sex)+sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement))
b14<-lm(data = d4[d4$V264==1,],V262~T4_4+as.factor(oblast)+as.factor(settlement_type)+as.factor(settlement)+as.factor(sex)+sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement))
b15<-lm(data = d4[d4$V264==1,],V263~T4_4+as.factor(oblast)+as.factor(settlement_type)+as.factor(settlement)+as.factor(sex)+sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement))
r11<-lm(data = d4[d4$V270==1,],V265~T4_4+as.factor(oblast)+as.factor(settlement_type)+as.factor(settlement)+as.factor(sex)+sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement))
r12<-lm(data = d4[d4$V270==1,],V266~T4_4+as.factor(oblast)+as.factor(settlement_type)+as.factor(settlement)+as.factor(sex)+sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement))
r13<-lm(data = d4[d4$V270==1,],V267~T4_4+as.factor(oblast)+as.factor(settlement_type)+as.factor(settlement)+as.factor(sex)+sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement))
r14<-lm(data = d4[d4$V270==1,],V268~T4_4+as.factor(oblast)+as.factor(settlement_type)+as.factor(settlement)+as.factor(sex)+sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement))
r15<-lm(data = d4[d4$V270==1,],V269~T4_4+as.factor(oblast)+as.factor(settlement_type)+as.factor(settlement)+as.factor(sex)+sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement))
t11<-lm(data = d4,V271~T4_4+as.factor(oblast)+as.factor(settlement_type)+as.factor(settlement)+as.factor(sex)+sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement))
t12<-lm(data = d4[d4$V273<6,],V273~T4_4+as.factor(oblast)+as.factor(settlement_type)+as.factor(settlement)+as.factor(sex)+sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement))
t13<-lm(data = d4[d4$V274<6,],V274~T4_4+as.factor(oblast)+as.factor(settlement_type)+as.factor(settlement)+as.factor(sex)+sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement))
t14<-lm(data = d4[d4$V275<6,],V275~T4_4+as.factor(oblast)+as.factor(settlement_type)+as.factor(settlement)+as.factor(sex)+sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement))
t15<-lm(data = d4[d4$V276<6,],V276~T4_4+as.factor(oblast)+as.factor(settlement_type)+as.factor(settlement)+as.factor(sex)+sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement))
a11_clustered <- coeftest(a11, vcov. = vcovCL(a11, cluster = ~ d4[d4$V248 < 11, ]$settlement))
a12_clustered <- coeftest(a12, vcov. = vcovCL(a12, cluster = ~ d4[d4$V249 < 11, ]$settlement))
a13_clustered <- coeftest(a13, vcov. = vcovCL(a13, cluster = ~ d4[d4$V250 < 11, ]$settlement))
a14_clustered <- coeftest(a14, vcov. = vcovCL(a14, cluster = ~ d4[d4$V250 < 11, ]$settlement))
b11_clustered <- coeftest(b11, vcov. = vcovCL(b11, cluster = ~ d4[d4$V264 == 1, ]$settlement))
b12_clustered <- coeftest(b12, vcov. = vcovCL(b12, cluster = ~ d4[d4$V264 == 1, ]$settlement))
b13_clustered <- coeftest(b13, vcov. = vcovCL(b13, cluster = ~ d4[d4$V264 == 1, ]$settlement))
b14_clustered <- coeftest(b14, vcov. = vcovCL(b14, cluster = ~ d4[d4$V264 == 1, ]$settlement))
b15_clustered <- coeftest(b15, vcov. = vcovCL(b15, cluster = ~ d4[d4$V264 == 1, ]$settlement))
r11_clustered <- coeftest(r11, vcov. = vcovCL(r11, cluster = ~ d4[d4$V270 == 1, ]$settlement))
r12_clustered <- coeftest(r12, vcov. = vcovCL(r12, cluster = ~ d4[d4$V270 == 1, ]$settlement))
r13_clustered <- coeftest(r13, vcov. = vcovCL(r13, cluster = ~ d4[d4$V270 == 1, ]$settlement))
r14_clustered <- coeftest(r14, vcov. = vcovCL(r14, cluster = ~ d4[d4$V270 == 1, ]$settlement))
r15_clustered <- coeftest(r15, vcov. = vcovCL(r15, cluster = ~ d4[d4$V270 == 1, ]$settlement))
t11_clustered <- coeftest(t11, vcov. = vcovCL(t11, cluster = ~ d4$settlement))
t12_clustered <- coeftest(t12, vcov. = vcovCL(t12, cluster = ~ d4[d4$V273 < 6, ]$settlement))
t13_clustered <- coeftest(t13, vcov. = vcovCL(t13, cluster = ~ d4[d4$V274 < 6, ]$settlement))
t14_clustered <- coeftest(t14, vcov. = vcovCL(t14, cluster = ~ d4[d4$V275 < 6, ]$settlement))
t15_clustered <- coeftest(t15, vcov. = vcovCL(t15, cluster = ~ d4[d4$V276<6,]$settlement))
p_load(modelsummary)
models <- list()
models[["More opportunity fo next gen"]]<-a11_clustered
models[["Life is comfortable"]]<-a12_clustered
models[["World is better off"]]<-a13_clustered
cm <- c('T4_4' = 'Home Damaged')
za<-modelplot(models, coef_map = cm,conf_level = .90,facet=T)+coord_flip()+theme(axis.text=element_text(size=12))+ggtitle('Attitudes towards Technology')+theme_bw()
models2 <- list()
models2[["Healthcare"]]<-b11_clustered
models2[["Infrastructure"]]<-b12_clustered
models2[["Education"]]<-b13_clustered
models2[["Technology"]]<-b14_clustered
models2[["Reduce Taxes"]]<-b15_clustered
zb<-modelplot(models2, coef_map = cm,conf_level = .90,facet=T)+coord_flip()+theme(axis.text=element_text(size=12))+ggtitle('Preferences over budget allocation')+theme_bw()
models3 <- list()
models3[["Healthcare"]]<-r11_clustered
models3[["Military"]]<-r12_clustered
models3[["AI & Communication"]]<-r13_clustered
models3[["Manufacturing"]]<-r14_clustered
models3[["Basic"]]<-r15_clustered
zc<-modelplot(models3, coef_map = cm,conf_level = .90,facet=T)+coord_flip()+theme(axis.text=element_text(size=12))+ggtitle('Preferences over drection of technological change')+theme_bw()
models4 <- list()
models4[["Build or Buy"]]<-t11_clustered
models4[["Consript all"]]<-t12_clustered
models4[["Conscript STEM"]]<-t13_clustered
models4[["Conscipt Health"]]<t14_clustered
models4[["Conscript Famous"]]<-t15_clustered
zd<-modelplot(models4, coef_map = cm,conf_level = .90,facet=T)+coord_flip()+theme(axis.text=element_text(size=12))+ggtitle('R&D-related policies')+theme_bw()
p_load(patchwork)
pdf("figs/fe/Home_damaged1.pdf")
za/
zb
dev.off()
pdf("figs/fe/Home_damaged2.pdf")
zc/
zd
dev.off()
# List all pre-treatment variables suitable for balance testing and optional conditioning
balvars=c("sd2","sex","d6","d3","urban_rural")
# prop score densities
dat_male=ukr_num2[ukr_num2$sex==1,]
dat_female=ukr_num2[ukr_num2$sex==2,]
bal_male=glm(T4_2~sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement),
data=dat_male, family="binomial")
bal_female=glm(T4_2~sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement),
data=dat_female, family="binomial")
dhat_male=predict(bal_male,dat_male, type="response")
dhat_male_tr=dhat_male[dat_male$T4_2==1]
dhat_male_ctrl=dhat_male[dat_male$T4_2==0]
dhat_female=predict(bal_female,dat_female, type="response")
dhat_female_tr=dhat_female[dat_female$T4_2==1]
dhat_female_ctrl=dhat_female[dat_female$T4_2==0]
# Without conditioning on settlement...looks terrible
pdf("Propensities_unweighted_male_famharm.pdf",width=7,height=7)
plot(density(dhat_male_tr),main="",ylim=c(0,4),xlab="Pr(Physical Harm)", lwd=3)
lines(density(dhat_male_ctrl), lty=2, lwd=3)
legend("topright", c("Family Physically Harmed","Family Not Physically Harmed"), lty=c(1,2), lwd=3)
dev.off()
pdf("Propensities_unweighted_female_famharm.pdf",width=7,height=7)
plot(density(dhat_female_tr),main="",ylim=c(0,4),xlab="Pr(Physical Harm)", lwd=3)
lines(density(dhat_female_ctrl), lty=2, lwd=3)
legend("topright", c("Family Physically Harmed","Family Not Physically Harmed"), lty=c(1,2), lwd=3)
dev.off()
dhat_male=predict(bal_male,dat_male, type="response")
dhat_male_tr=dhat_male[dat_male$T4_2==1]
dhat_male_ctrl=dhat_male[dat_male$T4_2==0]
dhat_female=predict(bal_female,dat_female, type="response")
dhat_female_tr=dhat_female[dat_female$T4_2==1]
dhat_female_ctrl=dhat_female[dat_female$T4_2==0]
plot(density(dhat_male_tr),main="",ylim=c(0,4),xlab="Pr(Physical Harm)", lwd=3)
lines(density(dhat_male_ctrl), lty=2, lwd=3)
legend("topright", c("Family Physically Harmed","Family Not Physically Harmed"), lty=c(1,2), lwd=3)
plot(density(dhat_female_tr),main="",ylim=c(0,4),xlab="Pr(Physical Harm)", lwd=3)
lines(density(dhat_female_ctrl), lty=2, lwd=3)
legend("topright", c("Family Physically Harmed","Family Not Physically Harmed"), lty=c(1,2), lwd=3)
vilweight=rep(1,length(dhat_male))
vilcount_tr=numeric(length(dhat_male))
vilcount_ctrl=numeric(length(dhat_male))
for (obs in 1:length(dhat_male)){
thisvillage=dat_male$settlement[obs]
tr_status=dat_male$T4_2[obs]
# Count how often this village occurs among treated and among control separately
vilcount_tr[obs]=sum(dat_male$settlement[dat_male$T4_2==1]==thisvillage)
vilcount_ctrl[obs]=sum(dat_male$settlement[dat_male$T4_2==0]==thisvillage)
if(tr_status==0 & vilcount_tr[obs]!=0) vilweight[obs]=vilcount_tr[obs]/vilcount_ctrl[obs]
if(tr_status==0 & vilcount_tr[obs]==0) vilweight[obs]=0
# For treated, leave weight at 1, unless the village doesn't appear among the controls
if(tr_status==1 & vilcount_ctrl[obs]==0) vilweight[obs]=0
}
vilweight_ctrl=vilweight[dat_male$T4_2==0]
vilweight_ctrl=vilweight_ctrl/sum(vilweight_ctrl)
vilweight_tr=vilweight[dat_male$T4_2==1]
vilweight_tr=vilweight_tr/sum(vilweight_tr)
plot(density(dhat_male_tr, weight=vilweight_tr), ylim=c(0,3),
main="",xlab="Pr(Physical Harm)", lwd=3)
lines(density(dhat_male_ctrl, weights=vilweight_ctrl), lty=2,lwd=3)
legend("topright", c("Physically Harmed","Not Physically Harmed"), lty=c(1,2),lwd=3)
vilweight=rep(1,length(dhat_female))
vilcount_tr=numeric(length(dhat_female))
vilcount_ctrl=numeric(length(dhat_female))
for (obs in 1:length(dhat_female)){
thisvillage=dat_female$settlement[obs]
tr_status=dat_female$T4_2[obs]
#count how often this village occurs among treated
vilcount_tr[obs]=sum(dat_female$settlement[dat_female$T4_2==1]==thisvillage)
vilcount_ctrl[obs]=sum(dat_female$settlement[dat_female$T4_2==0]==thisvillage)
if(tr_status==0 & vilcount_tr[obs]!=0) vilweight[obs]=vilcount_tr[obs]/vilcount_ctrl[obs]
if(tr_status==0 & vilcount_tr[obs]==0) vilweight[obs]=0
#for treated, leave weight at 1, unless the village doesn't appear among the controls
if(tr_status==1 & vilcount_ctrl[obs]==0) vilweight[obs]=0
}
# Without conditioning on village...looks terrible
vilweight_ctrl=vilweight[dat_female$T4_2==0]
vilweight_ctrl=vilweight_ctrl/sum(vilweight_ctrl)
vilweight_tr=vilweight[dat_female$T4_2==1]
vilweight_tr=vilweight_tr/sum(vilweight_tr)
plot(density(dhat_female_tr, weight=vilweight_tr, adjust=1.5), lwd=3,
ylim=c(0,3), main="",xlab="Pr(Physical Harm)")
lines(density(dhat_female_ctrl, weights=vilweight_ctrl, adjust = 1.5), lty=2, lwd=3)
legend("topright", c("Physically Harmed","Not Physically Harmed"), lty=c(1,2), lwd=3)
# prop score densities
dat_male=ukr_num2[ukr_num2$sex==1,]
dat_female=ukr_num2[ukr_num2$sex==2,]
bal_male=glm(T4_1~sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement),
data=dat_male, family="binomial")
bal_male=glm(T4_1~sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement),
data=dat_male, family="binomial")
bal_female=glm(T4_1~sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement),
data=dat_female, family="binomial")
dhat_male=predict(bal_male,dat_male, type="response")
dhat_male_tr=dhat_male[dat_male$T4_2==1]
dhat_male_ctrl=dhat_male[dat_male$T4_2==0]
dhat_female=predict(bal_female,dat_female, type="response")
dhat_female_tr=dhat_female[dat_female$T4_2==1]
dhat_male=predict(bal_male,dat_male, type="response")
dhat_male_tr=dhat_male[dat_male$T4_1==1]
dhat_male_ctrl=dhat_male[dat_male$T4_1==0]
dhat_female=predict(bal_female,dat_female, type="response")
dhat_female_tr=dhat_female[dat_female$T4_1==1]
dhat_female_ctrl=dhat_female[dat_female$T4_1==0]
plot(density(dhat_male_tr),main="",ylim=c(0,4),xlab="Pr(Physical Harm)", lwd=3)
lines(density(dhat_male_ctrl), lty=2, lwd=3)
legend("topright", c("Family Physically Harmed","Family Not Physically Harmed"), lty=c(1,2), lwd=3)
plot(density(dhat_female_tr),main="",ylim=c(0,4),xlab="Pr(Physical Harm)", lwd=3)
lines(density(dhat_female_ctrl), lty=2, lwd=3)
legend("topright", c("Family Physically Harmed","Family Not Physically Harmed"), lty=c(1,2), lwd=3)
plot(density(dhat_male_tr),main="",ylim=c(0,4),xlab="Pr(Physical Harm)", lwd=3)
lines(density(dhat_male_ctrl), lty=2, lwd=3)
legend("topright", c("Person Physically Harmed","Person Not Physically Harmed"), lty=c(1,2), lwd=3)
plot(density(dhat_female_tr),main="",ylim=c(0,4),xlab="Pr(Physical Harm)", lwd=3)
lines(density(dhat_female_ctrl), lty=2, lwd=3)
legend("topright", c("Person Physically Harmed","Person Not Physically Harmed"), lty=c(1,2), lwd=3)
dev.off()
vilweight=rep(1,length(dhat_male))
vilcount_tr=numeric(length(dhat_male))
vilcount_ctrl=numeric(length(dhat_male))
# Loop to keep calculation very simple:
for (obs in 1:length(dhat_male)){
thisvillage=dat_male$settlement[obs]
tr_status=dat_male$T4_2[obs]
# Count how often this village occurs among treated and among control separately
vilcount_tr[obs]=sum(dat_male$settlement[dat_male$T4_2==1]==thisvillage)
vilcount_ctrl[obs]=sum(dat_male$settlement[dat_male$T4_2==0]==thisvillage)
if(tr_status==0 & vilcount_tr[obs]!=0) vilweight[obs]=vilcount_tr[obs]/vilcount_ctrl[obs]
if(tr_status==0 & vilcount_tr[obs]==0) vilweight[obs]=0
# For treated, leave weight at 1, unless the village doesn't appear among the controls
if(tr_status==1 & vilcount_ctrl[obs]==0) vilweight[obs]=0
}
vilweight_ctrl=vilweight[dat_male$T4_2==0]
vilweight_ctrl=vilweight_ctrl/sum(vilweight_ctrl)
vilweight_tr=vilweight[dat_male$T4_2==1]
vilweight_tr=vilweight_tr/sum(vilweight_tr)
plot(density(dhat_male_tr, weight=vilweight_tr), ylim=c(0,3),
main="",xlab="Pr(Physical Harm)", lwd=3)
# Reweight untreated based on village
vilweight=rep(1,length(dhat_male))
vilcount_tr=numeric(length(dhat_male))
vilcount_ctrl=numeric(length(dhat_male))
# Loop to keep calculation very simple:
for (obs in 1:length(dhat_male)){
thisvillage=dat_male$settlement[obs]
tr_status=dat_male$T4_2[obs]
# Count how often this village occurs among treated and among control separately
vilcount_tr[obs]=sum(dat_male$settlement[dat_male$T4_2==1]==thisvillage)
vilcount_ctrl[obs]=sum(dat_male$settlement[dat_male$T4_2==0]==thisvillage)
if(tr_status==0 & vilcount_tr[obs]!=0) vilweight[obs]=vilcount_tr[obs]/vilcount_ctrl[obs]
if(tr_status==0 & vilcount_tr[obs]==0) vilweight[obs]=0
# For treated, leave weight at 1, unless the village doesn't appear among the controls
if(tr_status==1 & vilcount_ctrl[obs]==0) vilweight[obs]=0
}
vilweight_ctrl=vilweight[dat_male$T4_2==0]
vilweight_ctrl=vilweight_ctrl/sum(vilweight_ctrl)
vilweight_tr=vilweight[dat_male$T4_2==1]
vilweight_tr=vilweight_tr/sum(vilweight_tr)
plot(density(dhat_male_tr, weight=vilweight_tr), ylim=c(0,3),
main="",xlab="Pr(Physical Harm)", lwd=3)
vilweight_ctrl=vilweight[dat_male$T4_1==0]
vilweight_ctrl=vilweight_ctrl/sum(vilweight_ctrl)
vilweight_tr=vilweight[dat_male$T4_1==1]
vilweight_tr=vilweight_tr/sum(vilweight_tr)
plot(density(dhat_male_tr, weight=vilweight_tr), ylim=c(0,3),
main="",xlab="Pr(Physical Harm)", lwd=3)
lines(density(dhat_male_ctrl, weights=vilweight_ctrl), lty=2,lwd=3)
legend("topright", c("Physically Harmed","Not Physically Harmed"), lty=c(1,2),lwd=3)
vilweight=rep(1,length(dhat_female))
vilcount_tr=numeric(length(dhat_female))
vilcount_ctrl=numeric(length(dhat_female))
for (obs in 1:length(dhat_female)){
thisvillage=dat_female$settlement[obs]
tr_status=dat_female$T4_2[obs]
#count how often this village occurs among treated
vilcount_tr[obs]=sum(dat_female$settlement[dat_female$T4_2==1]==thisvillage)
vilcount_ctrl[obs]=sum(dat_female$settlement[dat_female$T4_2==0]==thisvillage)
if(tr_status==0 & vilcount_tr[obs]!=0) vilweight[obs]=vilcount_tr[obs]/vilcount_ctrl[obs]
if(tr_status==0 & vilcount_tr[obs]==0) vilweight[obs]=0
#for treated, leave weight at 1, unless the village doesn't appear among the controls
if(tr_status==1 & vilcount_ctrl[obs]==0) vilweight[obs]=0
}
# Without conditioning on village...looks terrible
vilweight_ctrl=vilweight[dat_female$T4_1==0]
vilweight_ctrl=vilweight_ctrl/sum(vilweight_ctrl)
vilweight_tr=vilweight[dat_female$T4_1==1]
vilweight_tr=vilweight_tr/sum(vilweight_tr)
plot(density(dhat_female_tr, weight=vilweight_tr, adjust=1.5), lwd=3,
ylim=c(0,3), main="",xlab="Pr(Physical Harm)")
lines(density(dhat_female_ctrl, weights=vilweight_ctrl, adjust = 1.5), lty=2, lwd=3)
legend("topright", c("Physically Harmed","Not Physically Harmed"), lty=c(1,2), lwd=3)
ukr_family<-ukr_num2[ukr_num2$family=1|ukr_num2$none=1,]
ukr_family<-ukr_num2[ukr_num2$family=1=|ukr_num2$none==1,]
ukr_family<-ukr_num2[ukr_num2$family==1|ukr_num2$none==1,]
ukr_family<-ukr_num2[ukr_num2$family==1|ukr_num2$none==1,]
# prop score densities
dat_male=ukr_family[ukr_family$sex==1,]
dat_female=ukr_family[ukr_family$sex==2,]
bal_male=glm(family~sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement),
data=dat_male, family="binomial")
bal_female=glm(family~sd2+as.factor(d3)+as.factor(d6)+as.factor(settlement),
data=dat_female, family="binomial")
dhat_male=predict(bal_male,dat_male, type="response")
dhat_male_tr=dhat_male[dat_male$T4_1==1]
dhat_male=predict(bal_male,dat_male, type="response")
dhat_male_tr=dhat_male[dat_male$family==1]
dhat_male_ctrl=dhat_male[dat_male$family==0]
dhat_female=predict(bal_female,dat_female, type="response")
dhat_female_tr=dhat_female[dat_female$family==1]
dhat_female_ctrl=dhat_female[dat_female$family==0]
plot(density(dhat_male_tr),main="",ylim=c(0,4),xlab="Pr(Physical Harm)", lwd=3)
lines(density(dhat_male_ctrl), lty=2, lwd=3)
legend("topright", c("Person Physically Harmed","Person Not Physically Harmed"), lty=c(1,2), lwd=3)
plot(density(dhat_female_tr),main="",ylim=c(0,4),xlab="Pr(Physical Harm)", lwd=3)
lines(density(dhat_female_ctrl), lty=2, lwd=3)
legend("topright", c("Person Physically Harmed","Person Not Physically Harmed"), lty=c(1,2), lwd=3)
vilweight=rep(1,length(dhat_male))
vilcount_tr=numeric(length(dhat_male))
vilcount_ctrl=numeric(length(dhat_male))
# Loop to keep calculation very simple:
for (obs in 1:length(dhat_male)){
thisvillage=dat_male$settlement[obs]
tr_status=dat_male$family[obs]
# Count how often this village occurs among treated and among control separately
vilcount_tr[obs]=sum(dat_male$settlement[dat_male$T4_2==1]==thisvillage)
vilcount_ctrl[obs]=sum(dat_male$settlement[dat_male$T4_2==0]==thisvillage)
if(tr_status==0 & vilcount_tr[obs]!=0) vilweight[obs]=vilcount_tr[obs]/vilcount_ctrl[obs]
if(tr_status==0 & vilcount_tr[obs]==0) vilweight[obs]=0
# For treated, leave weight at 1, unless the village doesn't appear among the controls
if(tr_status==1 & vilcount_ctrl[obs]==0) vilweight[obs]=0
}
vilweight_ctrl=vilweight[dat_male$family==0]
vilweight_ctrl=vilweight_ctrl/sum(vilweight_ctrl)
vilweight_tr=vilweight[dat_male$family==1]
vilweight_tr=vilweight_tr/sum(vilweight_tr)
plot(density(dhat_male_tr, weight=vilweight_tr), ylim=c(0,3),
main="",xlab="Pr(Family Affected)", lwd=3)
lines(density(dhat_male_ctrl, weights=vilweight_ctrl), lty=2,lwd=3)
legend("topright", c("Family Affected","Family Not Affected"), lty=c(1,2),lwd=3)
bal_male=glm(family~sd2+as.factor(d3)+as.factor(settlement),
data=dat_male, family="binomial")
bal_female=glm(family~sd2+as.factor(d3)+as.factor(settlement),
data=dat_female, family="binomial")
dhat_male=predict(bal_male,dat_male, type="response")
dhat_male_tr=dhat_male[dat_male$family==1]
dhat_male_ctrl=dhat_male[dat_male$family==0]
dhat_female=predict(bal_female,dat_female, type="response")
dhat_female_tr=dhat_female[dat_female$family==1]
dhat_female_ctrl=dhat_female[dat_female$family==0]
plot(density(dhat_male_tr),main="",ylim=c(0,4),xlab="Pr(Physical Harm)", lwd=3)
lines(density(dhat_male_ctrl), lty=2, lwd=3)
legend("topright", c("Family Affected","Famlily not Affected"), lty=c(1,2), lwd=3)
plot(density(dhat_female_tr),main="",ylim=c(0,4),xlab="Pr(Physical Harm)", lwd=3)
lines(density(dhat_female_ctrl), lty=2, lwd=3)
legend("topright", c("Family Affected","Famlily not Affected"), lty=c(1,2), lwd=3)
# Reweight untreated based on village
vilweight=rep(1,length(dhat_male))
vilcount_tr=numeric(length(dhat_male))
vilcount_ctrl=numeric(length(dhat_male))
# Loop to keep calculation very simple:
for (obs in 1:length(dhat_male)){
thisvillage=dat_male$settlement[obs]
tr_status=dat_male$family[obs]
# Count how often this village occurs among treated and among control separately
vilcount_tr[obs]=sum(dat_male$settlement[dat_male$T4_2==1]==thisvillage)
vilcount_ctrl[obs]=sum(dat_male$settlement[dat_male$T4_2==0]==thisvillage)
if(tr_status==0 & vilcount_tr[obs]!=0) vilweight[obs]=vilcount_tr[obs]/vilcount_ctrl[obs]
if(tr_status==0 & vilcount_tr[obs]==0) vilweight[obs]=0
# For treated, leave weight at 1, unless the village doesn't appear among the controls
if(tr_status==1 & vilcount_ctrl[obs]==0) vilweight[obs]=0
}
vilweight_ctrl=vilweight[dat_male$family==0]
vilweight_ctrl=vilweight_ctrl/sum(vilweight_ctrl)
vilweight_tr=vilweight[dat_male$family==1]
vilweight_tr=vilweight_tr/sum(vilweight_tr)
plot(density(dhat_male_tr, weight=vilweight_tr), ylim=c(0,3),
main="",xlab="Pr(Family Affected)", lwd=3)
lines(density(dhat_male_ctrl, weights=vilweight_ctrl), lty=2,lwd=3)
legend("topright", c("Family Affected","Family Not Affected"), lty=c(1,2),lwd=3)
vilweight=rep(1,length(dhat_male))
vilcount_tr=numeric(length(dhat_male))
vilcount_ctrl=numeric(length(dhat_male))
# Loop to keep calculation very simple:
for (obs in 1:length(dhat_male)){
thisvillage=dat_male$settlement[obs]
tr_status=dat_male$family[obs]
# Count how often this village occurs among treated and among control separately
vilcount_tr[obs]=sum(dat_male$settlement[dat_male$T4_2==1]==thisvillage)
vilcount_ctrl[obs]=sum(dat_male$settlement[dat_male$T4_2==0]==thisvillage)
if(tr_status==0 & vilcount_tr[obs]!=0) vilweight[obs]=vilcount_tr[obs]/vilcount_ctrl[obs]
if(tr_status==0 & vilcount_tr[obs]==0) vilweight[obs]=0
# For treated, leave weight at 1, unless the village doesn't appear among the controls
if(tr_status==1 & vilcount_ctrl[obs]==0) vilweight[obs]=0
}
vilweight_ctrl=vilweight[dat_male$family==0]
vilweight_ctrl=vilweight_ctrl/sum(vilweight_ctrl)
vilweight_tr=vilweight[dat_male$family==1]
vilweight_tr=vilweight_tr/sum(vilweight_tr)
# Reweight untreated based on village
vilweight=rep(1,length(dhat_male))
vilcount_tr=numeric(length(dhat_male))
vilcount_ctrl=numeric(length(dhat_male))
# Loop to keep calculation very simple:
for (obs in 1:length(dhat_male)){
thisvillage=dat_male$settlement[obs]
tr_status=dat_male$family[obs]
# Count how often this village occurs among treated and among control separately
vilcount_tr[obs]=sum(dat_male$settlement[dat_male$family==1]==thisvillage)
vilcount_ctrl[obs]=sum(dat_male$settlement[dat_male$family==0]==thisvillage)
if(tr_status==0 & vilcount_tr[obs]!=0) vilweight[obs]=vilcount_tr[obs]/vilcount_ctrl[obs]
if(tr_status==0 & vilcount_tr[obs]==0) vilweight[obs]=0
# For treated, leave weight at 1, unless the village doesn't appear among the controls
if(tr_status==1 & vilcount_ctrl[obs]==0) vilweight[obs]=0
}
vilweight_ctrl=vilweight[dat_male$family==0]
vilweight_ctrl=vilweight_ctrl/sum(vilweight_ctrl)
vilweight_tr=vilweight[dat_male$family==1]
vilweight_tr=vilweight_tr/sum(vilweight_tr)
plot(density(dhat_male_tr, weight=vilweight_tr), ylim=c(0,3),
main="",xlab="Pr(Family Affected)", lwd=3)
lines(density(dhat_male_ctrl, weights=vilweight_ctrl), lty=2,lwd=3)
legend("topright", c("Family Affected","Family Not Affected"), lty=c(1,2),lwd=3)
vilweight=rep(1,length(dhat_female))
vilcount_tr=numeric(length(dhat_female))
vilcount_ctrl=numeric(length(dhat_female))
for (obs in 1:length(dhat_female)){
thisvillage=dat_female$settlement[obs]
tr_status=dat_female$family[obs]
#count how often this village occurs among treated
vilcount_tr[obs]=sum(dat_female$settlement[dat_female$family==1]==thisvillage)
vilcount_ctrl[obs]=sum(dat_female$settlement[dat_female$family==0]==thisvillage)
if(tr_status==0 & vilcount_tr[obs]!=0) vilweight[obs]=vilcount_tr[obs]/vilcount_ctrl[obs]
if(tr_status==0 & vilcount_tr[obs]==0) vilweight[obs]=0
#for treated, leave weight at 1, unless the village doesn't appear among the controls
if(tr_status==1 & vilcount_ctrl[obs]==0) vilweight[obs]=0
}
# Without conditioning on village...looks terrible
vilweight_ctrl=vilweight[dat_female$family==0]
vilweight_ctrl=vilweight_ctrl/sum(vilweight_ctrl)
vilweight_tr=vilweight[dat_female$famoily==1]
vilweight_tr=vilweight_tr/sum(vilweight_tr)
plot(density(dhat_female_tr, weight=vilweight_tr, adjust=1.5), lwd=3,
ylim=c(0,3), main="",xlab="Pr(Physical Harm)")
ukr_family<-ukr_num2[ukr_num2$family==1|ukr_num2$none==1,]
# prop score densities
dat_male=ukr_family[ukr_family$sex==1,]
dat_female=ukr_family[ukr_family$sex==2,]
vilweight=rep(1,length(dhat_female))
vilcount_tr=numeric(length(dhat_female))
vilcount_ctrl=numeric(length(dhat_female))
for (obs in 1:length(dhat_female)){
thisvillage=dat_female$settlement[obs]
tr_status=dat_female$family[obs]
#count how often this village occurs among treated
vilcount_tr[obs]=sum(dat_female$settlement[dat_female$family==1]==thisvillage)
vilcount_ctrl[obs]=sum(dat_female$settlement[dat_female$family==0]==thisvillage)
if(tr_status==0 & vilcount_tr[obs]!=0) vilweight[obs]=vilcount_tr[obs]/vilcount_ctrl[obs]
if(tr_status==0 & vilcount_tr[obs]==0) vilweight[obs]=0
#for treated, leave weight at 1, unless the village doesn't appear among the controls
if(tr_status==1 & vilcount_ctrl[obs]==0) vilweight[obs]=0
}
# Without conditioning on village...looks terrible
vilweight_ctrl=vilweight[dat_female$family==0]
vilweight_ctrl=vilweight_ctrl/sum(vilweight_ctrl)
vilweight_tr=vilweight[dat_female$famoily==1]
vilweight_tr=vilweight_tr/sum(vilweight_tr)
plot(density(dhat_female_tr, weight=vilweight_tr, adjust=1.5), lwd=3,
ylim=c(0,3), main="",xlab="Pr(Physical Harm)")
# Repeat, tediously, for females
vilweight=rep(1,length(dhat_female))
vilcount_tr=numeric(length(dhat_female))
vilcount_ctrl=numeric(length(dhat_female))
for (obs in 1:length(dhat_female)){
thisvillage=dat_female$settlement[obs]
tr_status=dat_female$family[obs]
#count how often this village occurs among treated
vilcount_tr[obs]=sum(dat_female$settlement[dat_female$family==1]==thisvillage)
vilcount_ctrl[obs]=sum(dat_female$settlement[dat_female$family==0]==thisvillage)
if(tr_status==0 & vilcount_tr[obs]!=0) vilweight[obs]=vilcount_tr[obs]/vilcount_ctrl[obs]
if(tr_status==0 & vilcount_tr[obs]==0) vilweight[obs]=0
#for treated, leave weight at 1, unless the village doesn't appear among the controls
if(tr_status==1 & vilcount_ctrl[obs]==0) vilweight[obs]=0
}
plot(density(dhat_female_tr, weight=vilweight_tr, adjust=1.5), lwd=3,
ylim=c(0,3), main="",xlab="Pr(Physical Harm)")
vilweight_ctrl=vilweight[dat_female$family==0]
vilweight_ctrl=vilweight_ctrl/sum(vilweight_ctrl)
vilweight_tr=vilweight[dat_female$family==1]
vilweight_tr=vilweight_tr/sum(vilweight_tr)
plot(density(dhat_female_tr, weight=vilweight_tr, adjust=1.5), lwd=3,
ylim=c(0,3), main="",xlab="Pr(Family Affected)")
lines(density(dhat_female_ctrl, weights=vilweight_ctrl, adjust = 1.5), lty=2, lwd=3)
legend("topright", c("Family Affected","Family Not Affected"), lty=c(1,2), lwd=3)
ukr_num2$unemploy[ukr_num2$d6==10,]<-1
ukr_num2$unemploy[ukr_num2$d6==10]<-1
table(ukr_num2$unemploy)
ukr_num2$unemploy<-0
ukr_num2$unemploy[ukr_num2$d6==10,]<-1
ukr_num2$unemploy[ukr_num2$d6==10]<-1
table(ukr_num2$unemploy)
plot(density(dhat_female_tr),main="",ylim=c(0,4),xlab="Pr(Physical Harm)", lwd=3)
lines(density(dhat_female_ctrl), lty=2, lwd=3)
legend("topright", c("Family Affected","Famlily not Affected"), lty=c(1,2), lwd=3)
plot(density(dhat_male_tr),main="",ylim=c(0,4),xlab="Pr(Physical Harm)", lwd=3)
lines(density(dhat_male_ctrl), lty=2, lwd=3)
legend("topright", c("Family Affected","Famlily not Affected"), lty=c(1,2), lwd=3)
#Without the village FEs - no good
bout.orig = MatchBalance(dat$directlyharmed~as.matrix(dat[,balvars]))
p_load(Metching)
p_load(Matching)
#Without the village FEs - no good
bout.orig = MatchBalance(dat$directlyharmed~as.matrix(dat[,balvars]))
# List all pre-treatment variables suitable for balance testing and optional conditioning
balvars=c("sd2","d3","settlement")
#Without the village FEs - no good
bout.orig = MatchBalance(dat$directlyharmed~as.matrix(ukr_family[,balvars]))
#Without the village FEs - no good
bout.orig = MatchBalance(ukr_family$family~as.matrix(ukr_family[,balvars]))
balvars=c("sd2","d3","settlement")
length(ukr_family[,balvars])
length(ukr_family)
View(ukr_family)
length(ukr_family$family)
#Without the village FEs - no good
bout.orig = MatchBalance(ukr_family$family~as.matrix(ukr_family[,balvars]))
length(ukr_family[,balvars])
length(is.na(ukr_family$settlement))
table(ukr_family$settlement)
length(is.na(ukr_family$sd2))
